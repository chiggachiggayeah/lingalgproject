Carl_pomerance
Math
balanced_subgroups_of_the_multiplicative_group
ABSTRACT. A subgroup H of (Z/dZ)
√ó is called balanced if every coset of H is evenly distributed
between the lower and upper halves of (Z/dZ)
√ó, i.e., has equal numbers of elements with representatives
in (0, d/2) and (d/2, d). This notion has applications to ranks of elliptic curves. We give a
simple criterion in terms of characters for a subgroup H to be balanced, and for a fixed integer p,
we study the distribution of integers d such that the cyclic subgroup of (Z/dZ)
√ó generated by p is
balanced.
1. INTRODUCTION
Let d > 2 be an integer and consider (Z/dZ)
√ó, the group of units modulo d. Let Ad be the
first half of (Z/dZ)
√ó; that is, Ad consists of residues with a representative in (0, d/2). Let Bd =
(Z/dZ)
√ó \ Ad be the second half of (Z/dZ)
√ó. We say a subgroup H of (Z/dZ)
√ó is balanced if
for each g ‚àà (Z/dZ)
√ó we have |gH ‚à© Ad| = |gH ‚à© Bd|; that is, each coset of H has equally many
members in the first half of (Z/dZ)
√ó as in the second half.
Let œï denote Euler‚Äôs function, so that œÜ(d) is the cardinality of (Z/dZ)
√ó. If n and m are coprime
integers with m > 0, let ln(m) denote the order of the cyclic subgroup hn mod mi generated by n
in (Z/mZ)
√ó (that is, ln(m) is the multiplicative order of n modulo m).
Our interest in balanced subgroups stems from the following result.
Theorem 1.1 ([2]). Let p be an odd prime number, let Fq be the finite field of cardinality q = p
f
,
and let Fq(u) be the rational function field over Fq. Let d be a positive integer not divisible by p,
and let Ed be the elliptic curve over Fq(u) defined by
y
2 = x(x + 1)(x + u
d
).
Then we have
Rank Ed(Fq(u)) = X
e|d, e>2
hp mod ei balanced
œï(e)
lq(e)
.
A few simple observations are in order. It is easy to see that h‚àí1i is a balanced subgroup of
(Z/dZ)
√ó. It is also easy to see that if 4 | d, then h
1
2
d + 1i is a balanced subgroup of (Z/dZ)
√ó. In
addition, if H is a balanced subgroup of (Z/dZ)
√ó and K is a subgroup of (Z/dZ)
√ó containing H,
then K is balanced as well. Indeed, K is a union of [K : H] cosets of H, so for each g ‚àà (Z/dZ)
√ó,
gK is a union of [K : H] cosets of H, each equally distributed between the first half of (Z/dZ)
√ó
and the second half. Thus, gK is also equally distributed between the first half and the second half.
Date: September 17, 2012.
2010 Mathematics Subject Classification. Primary 11N37; Secondary 11G05.
The first author was partially supported by NSF grant DMS-1001180.
12 CARL POMERANCE AND DOUGLAS ULMER
It follows that if some power of p is congruent to ‚àí1 modulo d and if q ‚â° 1 (mod d), then
the theorem implies that Rank Ed(Fq(u)) = d ‚àí 2 if d is even and d ‚àí 1 if d is odd. The rank of
Ed when some power of p is ‚àí1 modulo d was first discussed in [12], and with hindsight it could
have been expected to be large from considerations of ‚Äúsupersingularity.‚Äù The results of [2] show,
perhaps surprisingly, that there are many other classes of d for which high ranks occur. Our aim
here is to make this observation more quantitative.
More precisely, the aim of this paper is to investigate various questions about balanced pairs
(p, d), i.e., pairs such that hp mod di is a balanced subgroup of (Z/dZ)
√ó. In particular, we give
a simple criterion in terms of characters for (p, d) to be balanced (Theorem 2.1), and we use it to
determine all balanced subgroups of order 2 (Theorem 3.2). We also investigate the distribution
for a fixed p of the set of d‚Äôs such that (p, d) is balanced (Theorems 4.1 to 4.3). We find that when
p is odd, the divisors d of numbers of the form p
n + 1 are not the largest contributor to this set.
Finally, we investigate the average rank and typical rank of the curves Ed in Theorem 1.1 for fixed
q and varying d.
2. BALANCED SUBGROUPS AND CHARACTERS
The goal of this section is to characterize balanced subgroups of (Z/dZ)
√ó in terms of Dirichlet
characters. If œá is a character modulo d, we define
cœá =
X
0<a<d/2
œá(a).
As usual, we say that œá is odd if œá(‚àí1) = ‚àí1 and œá is even if œá(‚àí1) = 1.
Theorem 2.1. A subgroup H ‚äÇ (Z/dZ)
√ó is balanced if and only if cœá = 0 for every odd character
œá of (Z/dZ)
√ó whose restriction to H is trivial.
As an example, note that if H = h‚àí1i, then there are no odd characters trivial on H and so the
theorem implies that H is balanced.
Proof. Throughout the proof, we write G for (Z/dZ)
√ó. We also write A for Ad as above and
similarly for B, so that G is the disjoint union A ‚à™ B.
We write 1A for the characteristic function of A ‚äÇ G and similarly for 1B. Let f : G ‚Üí C be
the sum over H of translates of 1A ‚àí 1B:
f(g) = X
h‚ààH
(1A(gh) ‚àí 1B(gh))
= #(gH ‚à© A) ‚àí #(gH ‚à© B).
By definition, H is balanced if and only if f is identically zero.
We write GÀÜ for the set of complex characters of G, and we expand f in terms of these characters:
f =
X
œá‚ààGÀÜ
ÀÜf(œá)œá
where
ÀÜf(œá) = 1
œï(d)
X
g‚ààG
f(g)œá
‚àí1
(g).
Thus, H is balanced if and only if ÀÜf(œá) = 0 for all œá ‚àà GÀÜ.ON BALANCED SUBGROUPS OF THE MULTIPLICATIVE GROUP 3
It is easy to see that ÀÜf(œátriv) = 0. Since 1A ‚àí 1B = 21A ‚àí 1G, for œá non-trivial we find that
ÀÜf(œá
‚àí1
) = 2
œï(d)
 X
h‚ààH
œá(h)
! X
a‚ààA
œá(a)
!
.
Note that P
h‚ààH œá(h) is zero if and only if the restriction of œá to H is non-trivial.
Note also that
cœá =
X
0<a<d/2
œá(a) = X
a‚ààA
œá(a)
since œá is a Dirichlet character. If œá is even and non-trivial, then
cœá =
1
2
X
g‚ààG
œá(g) = 0.
Thus ÀÜf(œá) = 0 for all œá ‚àà GÀÜ if and only if cœá = 0 for all odd characters œá which are trivial on
H. This completes the proof of the theorem.
We now give a non-vanishing criterion for cœá.
Lemma 2.2. If œá is a primitive, odd character of (Z/dZ)
√ó, then cœá 6= 0.
Proof. Under the hypotheses on œá, the classical evaluation of L(1, œá) leads to the formula
L(1, œá‚àí1
) = œÄiœÑ (œá
‚àí1
)
d(œá‚àí1
(2) ‚àí 2)cœá
where œÑ (œá
‚àí1
) is a Gauss sum. (See, e.g., [7, pp. 200‚Äì201] or [8, Theorem 9.21], though there is a
small typo in the second reference.) By the theorem of Dirichlet, L(1, œá‚àí1
) 6= 0 and so cœá 6= 0.
In light of the lemma, we should consider imprimitive characters.
Lemma 2.3. Suppose that ` is a prime number dividing d and set d
0 = d/`. Suppose also that œá is a
non-trivial character modulo d induced by a character œá
0 modulo d
0
. If ` = 2, then cœá = ‚àíœá
0
(2)cœá0.
If ` is odd, then cœá = (1 ‚àí œá
0
(`))cœá0. Here we employ the usual convention that œá
0
(`) = 0 if ` | d
0
.
Proof. First suppose ` = 2. We have
cœá =
X
a<d/2
gcd(a,d)=1
œá(a) = X
a<d0
gcd(a,2d
0
)=1
œá
0
(a).
If 2 | d
0
, this is a complete character sum and so vanishes. If 2 6 | d
0
, then
X
a<d0
gcd(a,2d
0
)=1
œá
0
(a) = X
a<d0
gcd(a,d0
)=1
œá
0
(a) ‚àí
X
a<d0/2
gcd(a,d0
)=1
œá
0
(2a)
= ‚àí
X
a<d0/2
gcd(a,d0
)=1
œá
0
(2a)
= ‚àíœá
0
(2)cœá0
as desired.
Now assume that ` is odd. We have
cœá =
X
a<d/2
gcd(a,d)=1
œá(a) = X
a<`d0/2
gcd(a,`d0
)=1
œá
0
(a).
If ` | d
0
, then
X
a<`d0/2
gcd(a,`d0
)=1
œá
0
(a) = X
a<d0/2
gcd(a,d0
)=1
œá
0
(a) = cœá0.
If ` 6 | d
0
, then
X
a<`d0/2
gcd(a,`d0
)=1
œá
0
(a) = X
a<`d0/2
gcd(a,d0
)=1
œá
0
(a) ‚àí
X
a<d0/2
gcd(a,d0
)=1
œá
0
(`a)
=
X
a<d0/2
gcd(a,d0
)=1
œá
0
(a) ‚àí œá
0
(`)
X
a<d0/2
gcd(a,d0
)=1
œá
0
(a)
= (1 ‚àí œá
0
(`))cœá0
as desired.
Applying the lemma repeatedly, we arrive at the following non-vanishing criterion.
Proposition 2.4. Suppose that œá is an odd character modulo d induced by a primitive character
œá
0 modulo d
0
. Then cœá 6= 0 if and only if the following two conditions both hold: (i) 4 6 | d or d/d0
is odd; and (ii) for every odd prime ` which divides d and does not divide d
0
, we have œá
0
(`) 6= 1.
As an example, suppose that 4 | d and H = h
1
2
d + 1i. Note that
(Z/dZ)
√ó/h
1
2
d + 1i ‚àº= (Z/
1
2
dZ)
√ó.
Thus, if œá is an odd character modulo d and œá(
1
2
d+ 1) = 1, then the conductor d
0 of œá divides d/2.
This shows that d/d0
is even and so condition (i) of the proposition fails and cœá = 0. Therefore H
is balanced.
3. BALANCED SUBGROUPS OF SMALL ORDER
In this section, we discuss balanced subgroups of small order. We have already seen that a
subgroup of (Z/dZ)
√ó which contains ‚àí1 or 1
2
d + 1 is balanced. We will show that in a certain
sense small balanced subgroups are controlled by these balanced subgroups of order 2.
Theorem 3.1. For every positive integer n there is an integer d(n) such that if d > d(n) and H is
a balanced subgroup of (Z/dZ)
√ó of order n, then either ‚àí1 ‚àà H or 4 | d and 1
2
d + 1 ‚àà H.
We can make this much more explicit for subgroups of order 2:
Theorem 3.2. A subgroup H = hhi of (Z/dZ)
√ó of order 2 is balanced if and only if d and h satisfy
one of the following conditions:
(1) h ‚â° ‚àí1 (mod d)
(2) d ‚â° 0 (mod 4) and h ‚â°
1
2
d + 1 (mod d)
(3) d = 24 and h ‚â° 17 (mod d) or h ‚â° 19 (mod d)
(4) d = 60 and h ‚â° 41 (mod d) or h ‚â° 49 (mod d).
Proof of Theorem 3.1. Throughout this proof and the next, we write G for (Z/dZ)
√ó. Using Proposition
2.4, we will show that if d is sufficiently large with respect to n, then for any subgroup
H ‚äÇ G of order n which does not contain ‚àí1 or 1
2
d + 1, there is a character œá which is odd, trivial
on H, and with cœá 6= 0. By Theorem 2.1, this implies that H is not balanced.
Note that a balanced subgroup obviously has even order, so there is no loss in assuming that n
is even. We make this assumption for the rest of the proof.
Let H+ be the subgroup of G generated by H, ‚àí1 and, if 4 | d, by 1
2
d + 1. Fix a character œá0
of G which is trivial on H, odd, and ‚àí1 on 1
2
d + 1 if 4 | d. The set of all characters satisfying
these restrictions is a homogeneous space for G/H\+ ‚äÇ Gb. We will argue that multiplying œá0 by a
suitable œà ‚àà G/H\+ yields a œá = œá0œà for which Proposition 2.4 implies that cœá 6= 0.
Note first that any character œá which is odd and, if 4 | d, has œá(
1
2
d + 1) = ‚àí1 automatically
satisfies condition (i) in Proposition 2.4. Indeed, if 4 | d, then the condition œá(
1
2
d + 1) = ‚àí1
implies that œá is 2-primitive, i.e., the conductor d
0 of œá has d/d0 odd. The rest of the argument
relates to condition (ii) in Proposition 2.4.
Write d =
Q
`
`
e` and write G` for (Z/`e`Z)
√ó so that G ‚àº=
Q
` G`
. Let œá =
Q
` œá`
. Note that `
divides the conductor of œá if and only if œá`
is non-trivial.
We will sloppily write G`/H+ for G` modulo the image of H+ in G`
. For odd `, G`
is cyclic
and therefore so is G`/H+; for ` = 2, since ‚àí1 ‚àà H+, G2/H+ is also cyclic.
Note also that H+ is the product of H and a group of exponent 2, namely the subgroup of G
generated by ‚àí1 or by ‚àí1 and 1
2
d + 1. Also, we have assumed that n = |H| is even. If ` is odd,
then G`
is cyclic of even order, so has a unique element of order 2. It follows that the order of the
image of H+ in G` divides n.
We define three sets of odd primes:
S1 =

odd ` : ` | d, G`/H+ = {1}
	
,
S2 = {odd ` : ` | d, œï(`
e`
) | n} ,
and
S3 = {odd ` : œï(`) | n} .
Note that S1 ‚äÇ S2 ‚äÇ S3 and S3 depends only on n, not on d.
If ` is odd, ` | d, and ` 6‚àà S1, then G`/H+ is non-trivial. Thus choosing a suitable œà, we may
arrange that the conductor of œá1 = œá0œà is divisible by every prime dividing d which is not in S1.
For the odd primes ` which divide d and do not divide the conductor of œá1 (a subset of S1, thus
also a subset of S3), we must arrange that œá
0
(`) 6= 1 (where œá
0
is the primitive character inducing
œá).
Recall that G`/H+ is cyclic. We now remark that if C is a cyclic group and a ‚àà C, and z ‚àà C,
then the set of characters œà : C ‚Üí C such that œá(a) 6= z has cardinality at least |C|(1 ‚àí 1/|hai|)
(where |hai| is the order of a). If we have several elements a1, . . . , an and several values z1, . . . , zn
to avoid, then the number of characters œà such that œà(ai) 6= zi
is at least
|C|

1 ‚àí
1
|ha1i| ‚àí ¬∑ ¬∑ ¬∑ ‚àí
1
|hani|
.
Thus we can find such a character provided that each ai has order > n.
Now we use that d is large to conclude that a large prime power `
e divides d. (Note that ` might
be 2 here.) Then G`/H+ is a cyclic group in which the order of each prime in S1 is large. (The
primes in S1 are also in S3, so belong to a set fixed independently of d.) We want a character œà6 CARL POMERANCE AND DOUGLAS ULMER
of G`/H+ which satisfies œà(r) 6= œá
‚àí1
1
(r) for all r ‚àà S1. We also want œàœá1 to have non-trivial `
component which, phrased in the language above, means that we want œà(a) 6= 1 for some fixed
generator of G`/H+. Since the size of S1 is fixed depending only on n, the discussion of the
previous paragraph shows that these conditions can be met if `
e
is large enough.
Setting œá = œàœá1 with œà as in the previous paragraph yields a character œá such that cœá 6= 0, and
this completes the proof.
Proof of Theorem 3.2. We retain the concepts and notation of the proof of Theorem 3.1. We also
say that a subgroup of order 2 is ‚Äúexceptional‚Äù if it does not contain ‚àí1 or 1
2
d + 1.
Since n = 2, the set S3 = {3} and the set S2 is either empty (if 3 6 | d or 9 | d) or S2 = {3}
(if 3 exactly divides d). If S2 is empty and H is an exceptional subgroup of order 2, then the first
part of the proof of Theorem 3.1 provides a primitive odd character trivial on H, and so H is not
balanced.
Suppose we are in the case where 3 exactly divides d. Following the first part of the proof of
Theorem 3.1, we have a character œá1 of G with conductor divisible by d
0 = d/3 which is odd,
trivial on H, and, if 4 | d, satisfies œá1(
1
2
d + 1) = ‚àí1. If the conductor of œá1 is d or if the primitive
character œá
0
inducing œá1 has œá
0
(3) 6= 1, then setting œá = œá1 we have cœá 6= 0 and we see that H is
not balanced.
If not, we will modify œá1. Note that if ` = 2 and 16 | d, or ` = 5 and 25 | d, or ` is a prime ‚â• 7
and ` | d, then the order of 3 in G`/H+ is at least 3. Thus in these cases, there is a character œà of
G`/H+ so that the ` part of œá = œá1œà is non-trivial and so that the primitive character œá
0
inducing
œá satisfies œá
0
(3) 6= 1. Then cœá 6= 0 and H is not balanced.
This leaves a small number of values of d to check for exceptional balanced subgroups of order
2. Namely, we just need to check divisors of 8 ¬∑ 3 ¬∑ 5 = 120 which are divisible by 3. A quick
computation which we leave to the reader finishes the proof.
4. DISTRIBUTION OF NUMBERS d WITH hp mod di BALANCED
For the rest of the paper, we write Ud for (Z/dZ)
√ó. Fix an integer p with |p| > 1. In our
application to elliptic curves, p is an odd prime number, but it seems interesting to state our results
on balanced subgroups in a more general context. Let Bp denote the set of integers d > 2 coprime
to p for which hp mod di is a balanced subgroup of Ud. Further, define subsets of Bp as follows:
Bp,0 = {d > 2 : (d, p) = 1, 4 | d, 1
2
d + 1 ‚àà hp mod di},
Bp,1 = {d > 2 : (d, p) = 1, ‚àí1 ‚àà hp mod di}
Bp,‚àó = Bp \ (Bp,0 ‚à™ Bp,1).
Note that if p is even then Bp,0 is empty. For any set A of positive integers and x a real number at
least 1, we let A(x) = |A ‚à© [1, x]|.
We state the principal results of this section, which show that when p is odd, most members of
Bp lie in Bp,0.
Theorem 4.1. For each odd integer p with |p| > 1, there are positive numbers bp, b0
p with
bp
x
log log x
‚â§ Bp,0(x) ‚â§ b
0
p
x
log log x
for all sufficiently large numbers x depending on the choice of p.
We remark that Bp,1 has been studied by Moree. In particular we have the following result.
Theorem 4.2 ([9, Thm. 5]). For each integer p with |p| > 1 there are positive numbers cp, Œ¥p such
that
Bp,1(x) ‚àº cp
x
(log x)
Œ¥p
as x ‚Üí ‚àû.
In particular, for p prime we have Œ¥p =
2
3
.
Theorem 4.3. For each integer p with |p| > 1, there is a number p > 0 such that for all x ‚â• 3,
Bp,‚àó(x) = Op

x
(log x)
p

.
Corollary 4.4. If p is an odd integer with |p| > 1, then Bp(x) ‚àº Bp,0(x) as x ‚Üí ‚àû.
It is easy to see that Bp,1 ‚à© Bp,0 has at most one element. Indeed, the cyclic group hp mod di
has at most one element of order exactly 2, so if d ‚àà Bp,1 ‚à© Bp,0, then for some f we have
p
f ‚â° ‚àí1 ‚â°
1
2
d + 1 (mod d) and this can happen only when d = 4. This shows that for x ‚â• 4,
Bp(x) ‚â• Bp,0(x) + Bp,1(x) ‚àí 1.
We believe that Bp,0 and Bp,1 comprise most of Bp and in fact we pose the following conjecture.
Conjecture 4.5. For each integer p with |p| > 1 we have
Bp(x) = Bp,0(x) + (1 + o(1))Bp,1(x) as x ‚Üí ‚àû,
that is, Bp,‚àó(x) = o(Bp,1(x)) as x ‚Üí ‚àû.
We now begin a discussion leading to the proofs of Theorems 4.1 and 4.3. The following useful
result comes from [4, Theorem 2.2].
Proposition 4.6. There is an absolute positive constant c such that for all numbers x ‚â• 3 and any
set R of primes in [1, x], the number of integers in [1, x] not divisible by any member of R is at
most
cx Y
r‚ààR

1 ‚àí
1
r

‚â§ cx exp
‚àí
X
r‚ààR
1
r
!
.
Note that the inequality in the display follows immediately from the inequality 1 ‚àí Œ∏ < e
‚àíŒ∏
for
every Œ∏ ‚àà (0, 1).
For a positive integer m coprime to p, recall that lp(m) denotes the order of hp mod mi. If r is
a prime, we let vr(m) denote that integer v with r
v
| m and r
v+1 6 | m.
We would like to give a criterion for membership in Bp,0, but before this, we establish an elementary
lemma.
Lemma 4.7. Let p be an odd integer with |p| > 1 and let k, i be positive integers. Then
v2

p
2
ik ‚àí 1
p
2k ‚àí 1
!
= i ‚àí 1.
Proof. The result is clear if i = 1. If i > 1, we see that
p
2
ik ‚àí 1
p
2k ‚àí 1
= (p
2k + 1)(p
4k + 1). . .(p
2
i‚àí1k + 1),
which is a product of i ‚àí 1 factors that are each 2 (mod 4). 
The following result gives a criterion for membership in Bp,0.
Proposition 4.8. Let p be odd with |p| > 1 and let m ‚â• 1 be an odd integer coprime to p. If lp(m)
is odd, then 2
jm ‚àà Bp,0 if and only if j = 1 + v2(p ‚àí 1) or j > v2(p
2 ‚àí 1). If lp(m) is even, then
2
jm ‚àà Bp,0 if and only if j > v2(p
lp(m) ‚àí 1).
Proof. We first prove the ‚Äúonly if" part. Assume that d = 2jm ‚àà Bp,0 and let f be an integer
with p
f ‚â°
1
2
d + 1 (mod d). Then lp(m) | f so that j ‚àí 1 = v2(p
f ‚àí 1) ‚â• v2(p
lp(m) ‚àí 1). This
establishes the ‚Äúonly if" part if lp(m) is even, and it also shows that j ‚â• 1 + v2(p ‚àí 1) always, so
in particular if lp(m) is odd. Suppose lp(m) is odd and 1 + v2(p ‚àí 1) < j ‚â§ v2(p
2 ‚àí 1). Then
j ‚àí 1 > v2(p ‚àí 1), so that lp(2j‚àí1m) is even. Using lp(m) odd, this implies that 2lp(m) | f, so that
2
j
| (p
2 ‚àí 1) | (p
f ‚àí 1), contradicting p
f ‚â°
1
2
d + 1 (mod d).
Towards showing the ‚Äúif" part, let v = v2(p
lp(m)‚àí1). We have p
lp(m)‚àí1 ‚â° 2
vm (mod 2v+1m),
so that 2
v+1m ‚àà Bp,0. If j > v + 1 and lp(m) is even, then with f = 2j‚àív‚àí1
lp(m), Lemma 4.7
implies that p
f ‚àí 1 ‚â° 2
j‚àí1m (mod 2jm), so that 2
jm ‚àà Bp,0. If lp(m) is odd, then v = v2(p ‚àí 1),
so that 2
v+1 ‚àà Bp,0. Finally assume that j > v2(p
2 ‚àí1) and lp(m) is odd. Then Lemma 4.7 implies
that p
2
j‚àív2(p
2‚àí1)lp(m) ‚àí 1 ‚â° 2
j‚àí1m (mod 2jm), so that 2
jm ‚àà Bp,0. This concludes the proof.
Proof of Theorem 4.1. For m ‚â• 1 coprime to 2p, let
fp(m) := v2

p
lp(m) ‚àí 1

, f0
p
(m) := max 
fp(m), v2

p
2 ‚àí 1
	 .
Proposition 4.8 implies that if 2
jm ‚àà Bp,0 with m odd, then j > fp(m). Further, if (m, 2p) = 1
then 2
jm ‚àà Bp,0 for all j > f0
p
(m).
Using this last property, we have Bp,0(x) at least as big as the number of choices for m coprime
to 2p with 1 < m ‚â§ x/2
f
0
p
(m)+1. Thus, the lower bound in the theorem will follow if we show that
there are at least bpx/ log log x integers m coprime to 2p with m ‚â§ x/2
f
0
p
(m)+1
.
Let Œª(m) denote Carmichael‚Äôs function at m, which is the order of the largest cyclic subgroup
of Um. Then lp(m) | Œª(m). Also, for m > 2, Œª(m) is even, so that
f
0
p
(m) ‚â§ gp(m) := v2

p
Œª(m) ‚àí 1

.
Thus, the lower bound in the theorem will follow if we show that there are at least bpx/ log log x
integers m coprime to 2p with m ‚â§ x/2
gp(m)+1. Using Lemma 4.7, we have gp(m) + 1 =
v2(Œª(m)) + v2(p
2 ‚àí 1). Further, it is easy to see that 2
v2(p
2‚àí1) ‚â§ 2(|p| + 1), with equality when
|p| + 1 is a power of 2.
It follows from [10, Section 2, Remark 1] that uniformly for all x ‚â• 3 and all positive integers
n, X
r‚â§x
r prime
n|r‚àí1
1
r
=
log log x
œï(n)
+ O

log(2n)
œï(n)

. (4.9)
We apply this with n = 2g0+1, where g0 is the first integer with 2
g0 ‚â• 4 log log x. Thus, if R is the
set of primes r ‚â§ x with v2(r ‚àí 1) > g0, we have for x sufficiently large,
X
r‚ààR
1
r
<
1
3
.
Let z = x/(25|p| log log x). In [1, z] there are (œï(|p|)/(2|p|))z + Op(1) integers coprime to 2p.
And for a given value of r ‚àà R there are at most (œï(|p|)/(2|p|))z/r + Op(1) numbers in [1, z]
coprime to 2p and divisible by r. It follows that for x sufficiently large depending on the choice of
p, there are at least
œï(|p|)
2|p|
z ‚àí
œï(|p|)
2|p|
z
X
r‚ààR
1
r
+ Op
 X
r‚ààR
1
!
>
œï(|p|)
4|p|
z
integers m ‚â§ z coprime to 2p and not divisible by any prime r ‚àà R. (We used that |R| =
O(x/ log x) to estimate the O-term above.)
It remains to note that if m ‚â§ z, m is coprime to 2p, and m is not divisible by any prime in R,
then v2(Œª(m)) ‚â§ g0, so that
2
gp(m)+1 ‚â§ 2
v2(Œª(m))+v2(p
2‚àí1) ‚â§ 2
g0 2
v2(p
2‚àí1) ‚â§ 2
g0
¬∑ 2(|p| + 1) ‚â§ 2
g0
¬∑ 3|p| < 25|p| log log x.
Thus, 2
gp(m)+1m ‚àà Bp,0 and 2
gp(m)+1m ‚â§ x, so that
Bp,0(x) ‚â•
œï(|p|)
100p
2
x
log log x
,
for x sufficiently large depending on the choice of p. This completes our proof of the lower bound.
For the upper bound, it suffices to show that
N(x) := Bp,0(x) ‚àí Bp,0(x/2) = Op

x
log log x

.
(With this assumption, no two numbers d counted can have the same odd part.) We shall assume
that p is not a square, the case when p = p
2
j
0
for some integer p0 and j ‚â• 1 being only slightly
more complicated. From Proposition 4.8, N(x) is at most the number of odd numbers m coprime
to p with m ‚â§ x/2
fp(m)+1. Let Nk(x) be the number of odd numbers m ‚â§ x/2
k+1 with m coprime
to p and fp(m) = k. Then
N(x) = X
k
Nk(x) = X
2
k‚â§log log x
Nk(x) + O

x
log log x

.
We now concentrate our attention on Nk(x) with 2
k ‚â§ log log x. If fp(m) = k, then m is not
divisible by any prime r with (p/r) = ‚àí1 and 2
k+1 | r ‚àí 1. Then, using (4.9) and quadratic
reciprocity,
X
r‚â§x
(p/r)=‚àí1
2
k+1|r‚àí1
r prime
1
r
=
log log x
2
k+1 + Op

k
2
k

.
By Proposition 4.6, the number of integers m ‚â§ x/2
k+1 not divisible by any such prime r is at
most
O

x
2
k+1 exp
‚àí
X
r
1
r
!! = Op

x
2
k+1 exp 
‚àí
log log x
2
k+1  .
Summing this expression for 2
k ‚â§ log log x gives Op(x/ log log x), which completes the proof of
Theorem 4.1. 
Remark 4.10. One might wonder if there is a positive constant Œ≤p such that if p is odd with |p| > 1,
then Bp,0(x) ‚àº Œ≤px/ log log x as x ‚Üí ‚àû. Here we sketch an argument that no such Œ≤p exists; that
is,
0 < lim inf
x‚Üí‚àû
Bp,0(x)
x/ log log x
< lim sup
x‚Üí‚àû
Bp,0(x)
x/ log log x
< ‚àû.
First note that but for Op(x/(log x)
1/2
) values of d ‚â§ x there is a prime r | d with (p/r) = ‚àí1.
(We are assuming here that p is not a square.) For such values of d = 2jm, with m odd, we have
2 | lp(m), so that in the notation above we have fp(m) = f
0
p
(m) ‚â• 3. Thus it suffices to count
numbers 2
jm ‚â§ x with m odd and j > fp(m) ‚â• 3. Note that
fp(m) = v2(lp(m)) + v2(p
2 ‚àí 1) ‚àí 1 = v2(lp(m)) + hp ‚àí 1,
say. Further,
v2(lp(m)) = max
r|m
v2(lp(r)),
where r runs over the prime divisors of m. We have
{r prime : v2(lp(r)) = k} =
[
i‚â•0
{r prime : v2(r ‚àí 1) = k + i, p is a 2
i
power (mod r) and not a 2
i+1 power (mod r)}.
For k > (log log log x)
2
, the density of primes r ‚â° 1 (mod 2k
) is so small that we may assume
that no d is divisible by such a prime r. For k below this bound, the density of primes r with
v2(lp(r)) = k is 1/(3 ¬∑ 2
k‚àí1
). Thus, there is a positive constant ck,p with ck,p ‚Üí 1 as k ‚Üí ‚àû such
that the density of integers m coprime to 2p and with fp(m) < k + hp is asymptotically equal to
cp(œï(2|p|)/(2|p|)) exp(‚àí(log log x)/(3 ¬∑ 2
k
)),
as x ‚Üí ‚àû. Thus, the number of m ‚â§ x/2
k+hp coprime to 2p and with fp(m) = k + hp ‚àí 1 is
asymptotically equal to
ck,p
œï(2|p|)
2|p|
x
2
k+hp
log log x
3 ¬∑ 2
k
exp 
‚àí
log log x
3 ¬∑ 2
k

as x ‚Üí ‚àû. This expression then needs to be summed over k. For k small, the count is negligible
because of the exp factor. For k larger, we can assume that the coefficients ck,p are all 1, and then
the sum takes on the form
œï(2|p|)
2|p|2
hp
x
log log x
X
k
(log log x)
2
3 ¬∑ 2
2k
exp 
‚àí
log log x
3 ¬∑ 2
k

.
Letting this sum on k be denoted g(x), it remains to note that g(x) is bounded away from both 0
and ‚àû yet does not tend to a limit, cf. [5, Theorem 3.25].
To prove Theorem 4.3, we first establish the following result.
Proposition 4.11. Let p be an integer with |p| > 1. Let d be a positive integer coprime to p such
that d is divisible by odd primes s, t with
lp(s) ‚â° 2 (mod 4), lp(t) ‚â° 1 (mod 2), hp, ‚àí1 mod si 6= Us, hp, ‚àí1 mod ti 6= Ut
.
Assume that 4 | lp(d). Then either 4 | d and 1
2
d + 1 ‚àà hp mod di or hp mod di is not balanced.ON BALANCED SUBGROUPS OF THE MULTIPLICATIVE GROUP 11
Proof. Let k = lp(d). First assume that 4 | d and 1
2
d + 1 6‚àà hp mod di. Let 2
Œ∫ be the largest power
of 2 in k. Write d = 2jm where m is odd, let 2
Œ∫1 be the power of 2 in lp(m), and let 2
Œ∫2 = lp(2j
).
Then Œ∫ = max{Œ∫1, Œ∫2}. Suppose that Œ∫2 > Œ∫1. We have p
k/2 ‚â° 1 (mod m) and p
k/2 6‚â° 1
(mod 2j
). Since 4 | k, we have p
k/2 + 1 ‚â° 2 (mod 4), and since p
k ‚àí 1 = (p
k/2 ‚àí 1)(p
k/2 + 1), we
have p
k/2 ‚â° 1 (mod 2e‚àí1
). Thus, p
k/2 ‚â°
1
2
d + 1 (mod d), contrary to our assumption. Hence,
we may assume that Œ∫ = Œ∫1 ‚â• Œ∫2. Note that this inequality holds too in the case that 4 6 | d, since
then, Œ∫2 = 0.
We categorize the odd prime powers r
a
coprime to p as follows.
‚Ä¢ Type 1: hp, ‚àí1 mod r
a
i = Ur
a.
‚Ä¢ Type 2: hp, ‚àí1 mod r
a
i 6= Ur
a.
‚Ä¢ Type 3: It is Type 2 and also lp(r
a
) ‚â° 2 (mod 4).
‚Ä¢ Type 4: It is Type 2 and also lp(r
a
) is odd.
By assumption d has at least one Type 3 prime power component and at least one Type 4 prime
power component. We will show that hp mod di is not balanced in Ud. By Proposition 2.4, it is
sufficient to exhibit an odd character œá (mod d) that is trivial at p with conductor d
0 divisible by
the same odd primes as are in d, and with either d ‚â° 2 (mod 4) or d/d0 odd.
Let r
a1
1 kd where the power of 2 in lp(r
a1
1
) is 2
Œ∫1
. (Note that r
a1
1
cannot be Type 3 nor Type 4,
since we have Œ∫1 = Œ∫ ‚â• 2, so that 4 | lp(r
a1
1
).) Consider the Type 1 prime powers in d, other than
possibly r
a1
1
in case it is of Type 1. For each we take the quadratic character and we multiply these
together to get a character œá1 whose conductor contains all of the primes involved in Type 1 prime
powers, except possibly r1.
If j ‚â§ 1, we let œà2
j be the principal character mod 2
j
. If j ‚â• 2, let œà2
j be a primitive character
mod 2
j with œà2
j (p) = Œ∂, a primitive 2
Œ∫2
-th root of unity. Let œá2 = œá1œà2
j .
We choose a character œàr
a1
1
mod r
a1
1 with œàr
a1
1
(p) = œá2(p)
‚àí1
if œá2(p) 6= 1, and otherwise we
choose it so that œàr
a1
1
(p) = ‚àí1. Thus, this character is non-principal. Let œá3 = œàr
a1
1
œá2. We now
have œá3(p) = ¬±1.
If œá3(p) = ‚àí1 we use a Type 3 prime power r
a3
3 kd and choose a character œàr
a3
3
(mod r
a3
3
) with
œàr
a3
3
(p) = ‚àí1. Let œá4 = œá3œàr
a3
3
. If œá3(p) = 1, we let œá4 = œá3. We now have œá4(p) = 1.
If œá4(‚àí1) = 1, we use a Type 4 prime power r
a4
4 kd and choose a character œàr
a4
4
(mod r
a4
4
) with
œàr
a4
4
(p) = 1 and œàr
a4
4
(‚àí1) = ‚àí1. Let œá5 = œá4œàr
a. If œá4(‚àí1) = ‚àí1, we let œá5 = œá4.
All remaining prime powers r
a
in d are of Type 2. For these we take non-principal characters
that are trivial on hp, ‚àí1 mod r
a
i, and multiply them in to œá5 to form œá6. This is the character we
are looking for, and so hp mod di is not balanced. This completes our proof.
Proof of Theorem 4.3. In the proof we shall assume that p is neither a square nor twice a square,
showing in these cases that we may take p = 1/16. The remaining cases are done with small
adjustments to the basic argument, but may require a smaller value for p.
Let d ‚â§ x be coprime to p. The set of primes r 6 | p with r ‚â° 1 (mod 4) and for which
p is a quadratic nonresidue has density 1/4, and in fact, the sum of reciprocals of such primes
r ‚â§ x is 1
4
log log x + Op(1). (This follows from either (4.9) and quadratic reciprocity or from the
Chebotarev density theorem.) Thus by Proposition 4.6, the number of integers d ‚â§ x not divisible
by any of these primes r is Op(x/(log x)
1/4
). Thus, we may assume that d is divisible by such a
prime r and so that 4 | lp(d).
Note that if r ‚â° 5 (mod 8) and that p is a quadratic residue modulo r, but not a fourth power,
then any r
a
is of Type 3. The density of these primes r is 1/16, by the Chebotarev theorem, in fact,
the sum of reciprocals of such primes r ‚â§ x is 1
16 log log x + Op(1). So the number of values of
d ‚àà [3, x] not divisible by at least one of them is Op(x/(log x)
1/16), using Proposition 4.6. Also
note that if r ‚â° 5 (mod 8) and p is a nonzero fourth power modulo r, then any r
a
is Type 4. The
density of these primes r is also 1/16, and again the number of d ‚àà [3, x] not divisible by at least
one of them is Op(x/(log x)
1/16).
Thus, the number of values of d ‚â§ x coprime to p and not satisfying the hypotheses of Proposition
4.11 is O(x/(log x)
1/16). This completes the proof of Theorem 4.3.
5. THE AVERAGE AND NORMAL ORDER OF THE RANK
In this section we consider the average and normal order of the rank of the curve Ed given in
Theorem 1.1 as d varies.
It is clear from Theorem 1.1 that for q odd,
Rank Ed(Fq(u)) ‚â§
(
d ‚àí 2 if d is even
d ‚àí 1 if d is odd
with equality when d ‚àà Bp,1 and q ‚â° 1 (mod d).
For all q and d > 1, it is known [1, Prop. 6.9] that
Rank Ed(Fq(u)) ‚â§
d
2 logq d
+ O

d
(logq d)
2

.
(Here logq d is the logarithm of d base q, i.e., log d/ log q.) We do not include the details here,
but this bound can be proved directly for the the curves in Theorem 1.1 using that theorem. In
addition, for q odd, considering values of d of the form q
f + 1 for some positive integer f, and
using Theorem 1.1, we see that the main term in this inequality is sharp for this family of curves.
We show below that although the average rank of Ed(Fq(u)) is large‚Äîits average for d up to x
is at least x
1/2‚Äîfor ‚Äúmost‚Äù values of d the rank is much smaller.
Theorem 5.1. There is an absolute constant Œ± > 1
2
with the following property. For each odd
prime p and finite field Fq of characteristic p, with Fq(u) and Ed as in Theorem 1.1, we have
x
Œ± ‚â§
1
x
X
d‚â§x
Rank Ed(Fq(u)) ‚â§ x
1‚àílog log log x/(2 log log x)
for all sufficiently large x depending on the choice of p.
Proof. This result follows almost immediately from [11, Theorem 1]. A result is proved there for
the average value of the rank of curves in a different family also parametrized by a positive integer
d. Using the notation from the present paper, if d ‚àà Bp,1 the rank of the curve considered in [11] is
within 4 of
X
e|d
e>2
œï(e)
lq(e)
. (5.2)
We have d ‚àà Bp,1 implies that e ‚àà Bp,1 for all e | d with e > 2. By Theorem 1.1, formula (5.2)
is exactly the rank of Ed(Fq(u)) for d ‚àà Bp,1. Since the proof of the lower bound x
Œ±
in [11] uses
only values of d ‚àà Bp,1, we have the lower bound x
Œ±
in the present theorem.
Since the rank of Ed(Fq(u)) is bounded above by the formula (5.2) whether or not d is in Bp,1,
and in fact whether or not hp mod di is balanced, the argument given in [11] for the upper bound
gives our upper bound here. 
Theorem 5.3. For each odd prime p and finite field Fq of characteristic p, with Fq(u) and Ed as in
Theorem 1.1, we have but for o(x/ log log x) values of d ‚â§ x with d ‚àà Bp that
Rank Ed(Fq(u)) ‚â• (log d)
(1+o(1)) log log log d
as x ‚Üí ‚àû. Further, assuming the GRH, we have but for o(x/ log log x) values of d ‚â§ x with
d ‚àà Bp that
Rank Ed(Fq(u)) ‚â§ (log d)
(1+o(1)) log log log d
as x ‚Üí ‚àû. Assuming the GRH, this upper bound holds but for o(x) values of d ‚â§ x coprime to p
as x ‚Üí ‚àû, regardless of whether d ‚àà Bp.
Proof. For d ‚àà Bp, Theorem 1.1 implies that the rank of Ed(Fq(u)) is at least œï(d)/lq(d) ‚â•
œï(d)/Œª(d), where Œª was defined in the previous section as the order of the largest cyclic subgroup
of Ud. It is shown in the proof of Theorem 2 in [3] that on a set of asymptotic density 1, we have
œï(d)/Œª(d) = (log d)
(1+o(1)) log log log d
. We would like to show this holds for almost all d ‚àà Bp. Note
that we have œï(m)/Œª(m) = (log m)
(1+o(1)) log log log m for almost all odd numbers m. We have for
all odd m and every integer j ‚â• 0 that
œï(m)
Œª(m)
‚â§
œï(2jm)
Œª(2jm)
‚â§ 2
j œï(m)
Œª(m)
. (5.4)
Thus, for almost all odd numbers m we have for all nonnegative integers j with 2
j ‚â§ log m that
œï(2jm)/Œª(2jm)) = (log(2jm))(1+o(1)) log log log(2jm)
. Further, it follows from (4.9) that but for a set
of odd numbers m of asymptotic density 0, we have v2(Œª(m)) ‚â§ 2 log log log m. It thus follows
from Proposition 4.8 that for almost all odd numbers m there is some nonnegative j with 2
jm ‚àà Bp
and 2
j ‚â§ log m. By Theorems 4.1, 4.3 almost all members of Bp are of this form, and so we have
the lower bound in the theorem.
For the upper bound we use an argument in [6]. There, Corollary 2 and the following remark
imply that under the assumption of the GRH, for almost all numbers d coprime to p we have
œï(d)/lq(d) = (log d)
(1+o(1)) log log log d
. We use that œï(e)/lq(e) | œï(d)/lq(d) for e | d and from the
normal order of the number-of-divisors function œÑ (d), that most numbers d have œÑ (d) ‚â§ log d. It
thus follows from Theorem 1.1 and the GRH that for almost all numbers d coprime to p that
RankEd(Fq(u)) ‚â§ œÑ (d)
œï(d)
lq(d)
‚â§ (log d)
œï(d)
lq(d)
= (log d)
(1+o(1)) log log log d
.
We would like to show as well that this inequality continues to hold for almost all d that are
in Bp. As above, the GRH implies that for almost all odd numbers m coprime to p, we have
œï(m)/lq(m) = (log m)
(1+o(1)) log log log m. Since (5.4) continues to hold with lq in place of Œª, it
follows that for almost all odd m and for all j with 1 ‚â§ 2
j ‚â§ log m, that œï(2jm)/lq(2jm) =
(log(2jm))(1+o(1)) log log log(2jm)
. Again using the normal order of the number-of-divisors function
œÑ , we have that for almost all odd m and all j with 1 ‚â§ 2
j ‚â§ log m that œÑ (2jm) ‚â§ log m. Further,
as we noted above, from Theorems 4.1, 4.3, it follows that almost all members d of Bp are of the
form 2
jm with m odd and 2
j ‚â§ log m. The rank formula in Theorem 1.1 implies that the rank of
Ed(Fq(u)) is bounded above by œÑ (d)œï(d)/lq(d). Thus, for almost all d ‚àà Bp we have the rank at
most (log d)
(1+o(1)) log log log d
. This completes the proof. 